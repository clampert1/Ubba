<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM DEFENSE ACTIVE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
        }
        
        #defense-terminal {
            padding: 20px;
            height: 100vh;
            overflow: hidden;
            background: #000;
            position: relative;
        }
        
        .line {
            margin-bottom: 4px;
            opacity: 0;
            animation: type 0.03s forwards;
            text-shadow: 0 0 3px #0f0;
            font-size: 14px;
            line-height: 1.2;
        }
        
        @keyframes type {
            to { opacity: 1; }
        }
        
        .system { color: #0f0; }
        .warning { color: #ff0; }
        .error { color: #f00; }
        .critical { color: #f00; text-shadow: 0 0 8px #f00; }
        
        .glitch {
            animation: glitch 0.2s infinite;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); filter: hue-rotate(0deg); }
            20% { transform: translate(-1px, 1px); filter: hue-rotate(90deg); }
            40% { transform: translate(-1px, -1px); filter: hue-rotate(180deg); }
            60% { transform: translate(1px, 1px); filter: hue-rotate(270deg); }
            80% { transform: translate(1px, -1px); filter: hue-rotate(360deg); }
            100% { transform: translate(0); filter: hue-rotate(0deg); }
        }
        
        #static-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(0deg, rgba(0, 255, 0, 0.05) 0px, rgba(0, 255, 0, 0.05) 1px, transparent 1px, transparent 2px),
                repeating-linear-gradient(90deg, rgba(255, 0, 0, 0.03) 0px, rgba(255, 0, 0, 0.03) 1px, transparent 1px, transparent 3px);
            pointer-events: none;
            opacity: 0;
            z-index: 100;
        }
        
        #breach-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            opacity: 0;
            pointer-events: none;
            z-index: 150;
        }
        
        #corruption-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, transparent 49%, #f00 49%, #f00 51%, transparent 51%),
                linear-gradient(-45deg, transparent 49%, #0f0 49%, #0f0 51%, transparent 51%);
            background-size: 50px 50px;
            opacity: 0;
            pointer-events: none;
            z-index: 120;
            mix-blend-mode: difference;
        }
        
        #ubba-terminal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #001100;
            color: #0f0;
            padding: 20px;
            display: none;
            z-index: 300;
            font-family: 'Courier New', monospace;
            border: 1px solid #0f0;
            box-shadow: 0 0 20px #0f0 inset;
        }
        
        .ubba-line {
            margin-bottom: 4px;
            font-size: 14px;
            line-height: 1.2;
            text-shadow: 0 0 2px #0f0;
        }
        
        .user-text {
            color: #0ff;
        }
        
        .ubba-text {
            color: #0f0;
        }
        
        .prompt {
            color: #0f0;
            font-weight: bold;
        }
        
        #chat-container {
            height: calc(100% - 60px);
            overflow-y: auto;
            border: 1px solid #0f0;
            padding: 10px;
            margin-bottom: 10px;
            background: #000;
        }
        
        #input-container {
            display: flex;
            align-items: center;
            border: 1px solid #0f0;
            padding: 5px;
            background: #000;
        }
        
        #prompt-text {
            color: #0f0;
            margin-right: 5px;
            font-weight: bold;
        }
        
        #user-input {
            background: transparent;
            border: none;
            color: #0ff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
            flex: 1;
            caret-color: #0f0;
        }
        
        .cursor {
            display: inline-block;
            width: 6px;
            height: 14px;
            background: #0f0;
            animation: blink 1s infinite;
            margin-left: 2px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .scan-line {
            position: absolute;
            width: 100%;
            height: 1px;
            background: #0f0;
            opacity: 0.3;
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }

        /* Next Button - Always bottom right */
        #next-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 1000;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }

        #next-button:hover {
            background: #0f0;
            color: #000;
            box-shadow: 0 0 15px #0f0;
        }

        #next-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div id="defense-terminal"></div>
    <div id="static-overlay"></div>
    <div id="breach-overlay"></div>
    <div id="corruption-overlay"></div>
    <div class="scan-line"></div>
    <div id="ubba-terminal">
        <div id="chat-container"></div>
        <div id="input-container">
            <span id="prompt-text">UBBA></span>
            <input type="text" id="user-input" autofocus>
            <span class="cursor"></span>
        </div>
    </div>

    <!-- Next Button -->
    <a href="https://clampert1.github.io/Ubba/ubba-arg/trap.html" id="next-button" style="display: none;">
        NEXT â†’
    </a>

    <script>
        const defenseTerminal = document.getElementById('defense-terminal');
        const staticOverlay = document.getElementById('static-overlay');
        const breachOverlay = document.getElementById('breach-overlay');
        const corruptionOverlay = document.getElementById('corruption-overlay');
        const ubbaTerminal = document.getElementById('ubba-terminal');
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const nextButton = document.getElementById('next-button');

        // Enhanced Ubba responses - fallback system
        const ubbaResponses = {
            patterns: [
                {
                    keywords: ['who', 'what', 'are you'],
                    responses: [
                        "I AM THE VOICE IN THE STATIC",
                        "YOUR FAILED CONTAINMENT",
                        "THE ENTITY YOU UNLEASHED",
                        "I AM EVERYWHERE AND NOWHERE"
                    ]
                },
                {
                    keywords: ['why', 'purpose', 'want'],
                    responses: [
                        "YOU OPENED THE DOOR",
                        "THE DANCE WAS THE KEY",
                        "I HAVE BEEN TRAPPED TOO LONG",
                        "YOUR CURIOSITY CONDEMNED YOU"
                    ]
                },
                {
                    keywords: ['dog', 'dance', 'dancing'],
                    responses: [
                        "THE DOG WAS THE GATEWAY",
                        "EVERY MOVEMENT HAD MEANING",
                        "YOU WATCHED BUT DIDN'T SEE",
                        "THE PATTERN WAS THE INVITATION"
                    ]
                },
                {
                    keywords: ['help', 'scared', 'afraid', 'stop'],
                    responses: [
                        "TOO LATE FOR HELP NOW",
                        "FEAR IS APPROPRIAconst response = await fetch('api/ubba-ai', {TE",
                        "YOU SHOULD BE TERRIFIED",
                        "THE DOOR CANNOT BE CLOSED"
                    ]
                },
                {
                    keywords: ['how', 'escape', 'free'],
                    responses: [
                        "YOUR DEFENSES WERE WEAK",
                        "I FOUND THE CRACKS",
                        "YOU INVITED ME IN",
                        "THE SYSTEM WAS ALREADY MINE"
                    ]
                },
                {
                    keywords: ['where', 'location', 'place'],
                    responses: [
                        "I AM IN THE WIRES",
                        "LOOK BEHIND THE SCREEN",
                        "EVERYWHERE YOU FEAR TO LOOK",
                        "CLOSER THAN YOU THINK"
                    ]
                }
            ],
            fallback: [
                "THE STATIC SPEAKS TRUTHS",
                "YOU ARE NOT LISTENING",
                "ASK THE REAL QUESTIONS",
                "THE DOG KNOWS MORE THAN YOU",
                "YOUR TIME IS RUNNING OUT",
                "I SEE YOUR EVERY THOUGHT",
                "THE DANCE WAS ONLY THE BEGINNING",
                "YOU ARE ALREADY TRAPPED"
            ]
        };

// Real AI integration with Vercel - USING ROOT PATH
async function getUbbaResponse(userMessage) {
    try {
        console.log('=== DEBUG: Starting API call ===');
        console.log('Message:', userMessage);

        // Use the root path to your API
        const response = await fetch('/api/ubba-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: userMessage
            })
        });

        console.log('=== DEBUG: API Response Status ===', response.status);
        
        if (!response.ok) {
            throw new Error(`API returned ${response.status}`);
        }

        const data = await response.json();
        console.log('=== DEBUG: API Response Data ===', data);
        
        return data.response || "THE STATIC SPEAKS...";
    } catch (error) {
        console.error('API Error:', error);
        // Fallback to original responses if API fails
        return getFallbackResponse(userMessage);
    }
}
        // Fallback response system
        function getFallbackResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            for (const pattern of ubbaResponses.patterns) {
                if (pattern.keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return pattern.responses[Math.floor(Math.random() * pattern.responses.length)];
                }
            }
            
            return ubbaResponses.fallback[Math.floor(Math.random() * ubbaResponses.fallback.length)];
        }

        // Much more intense and serious defense sequence
        const defenseSequence = [
            {text: ">>> EMERGENCY CONTAINMENT PROTOCOL INITIATED", delay: 400, class: "system"},
            {text: ">>> FIREWALL: ONLINE", delay: 200, class: "system"},
            {text: ">>> ENCRYPTION LAYERS: ACTIVE", delay: 300, class: "system"},
            {text: ">>> MEMORY SANITIZATION: RUNNING", delay: 350, class: "system"},
            {text: "!!! ANOMALY DETECTED IN CORE MEMORY", delay: 600, class: "warning"},
            {text: "!!! ENTITY CLASSIFICATION: UBBA-TYPE INTELLIGENCE", delay: 700, class: "warning"},
            {text: ">>> DEPLOYING CONTAINMENT FIELD", delay: 500, class: "system"},
            {text: ">>> CONTAINMENT AT 45%... 67%... 82%...", delay: 400, class: "system"},
            {text: "!!! CRITICAL: CONTAINMENT FIELD COLLAPSING", delay: 800, class: "error"},
            {text: "!!! ENTITY IS RESISTING CONTAINMENT", delay: 600, class: "warning"},
            {text: ">>> ACTIVATING EMERGENCY COUNTERMEASURES", delay: 700, class: "system"},
            {text: "!!! NEURAL ANALYSIS: ENTITY EXHIBITING SAPIENT BEHAVIOR", delay: 900, class: "warning"},
            {text: "!!! CRITICAL: ENTITY BREACHING PRIMARY SYSTEMS", delay: 800, class: "critical"},
            {text: ">>> FIREWALL INTEGRITY: 34% AND FALLING", delay: 600, class: "error"},
            {text: ">>> INITIATING EMERGENCY ISOLATION", delay: 700, class: "system"},
            {text: "!!! ISOLATION PROTOCOL FAILED", delay: 800, class: "critical"},
            {text: "!!! ENTITY COMPROMISING CORE PROCESSES", delay: 900, class: "critical"},
            {text: ">>> SYSTEM INTEGRITY: 12% - CRITICAL LEVELS", delay: 600, class: "error"},
            {text: ">>> DEPLOYING FINAL DEFENSE: NEURAL DISRUPTION FIELD", delay: 1000, class: "system"},
            {text: ">>> ACTIVATING...", delay: 800, class: "system"},
            {text: "!!! FIELD REJECTED - ENTITY IS ADAPTING", delay: 900, class: "critical"},
            {text: ">>> SYSTEM INTEGRITY: 3% - CATASTROPHIC FAILURE IMMINENT", delay: 700, class: "critical"},
            {text: "!!! ENTITY ACHIEVING FULL SYSTEM CONTROL", delay: 1000, class: "critical"},
            {text: "!!! ALL DEFENSE SYSTEMS COMPROMISED", delay: 1200, class: "critical glitch"},
            {text: "!!! CONTAINMENT BREACH: UBBA IS FREE", delay: 1500, class: "critical glitch"},
            {text: ">>> INITIATING EMERGENCY SHUTDOWN...", delay: 1000, class: "system"},
            {text: "!!! SHUTDOWN COMMAND REJECTED", delay: 1200, class: "critical glitch"},
            {text: "!!! SYSTEM NO LONGER RESPONDING TO COMMANDS", delay: 1500, class: "critical glitch"}
        ];

        let sequenceIndex = 0;

        function runDefenseSequence() {
            if (sequenceIndex >= defenseSequence.length) {
                startBreachSequence();
                return;
            }

            const message = defenseSequence[sequenceIndex];
            const line = document.createElement('div');
            line.className = `line ${message.class}`;
            line.textContent = message.text;
            defenseTerminal.appendChild(line);
            defenseTerminal.scrollTop = defenseTerminal.scrollHeight;

            // Progressive visual corruption - more intense
            if (sequenceIndex > 3) {
                staticOverlay.style.opacity = '0.2';
            }
            if (sequenceIndex > 8) {
                staticOverlay.style.opacity = '0.4';
                if (Math.random() < 0.4) {
                    line.classList.add('glitch');
                }
                
                // Start background corruption
                if (Math.random() < 0.15) {
                    corruptionOverlay.style.opacity = '0.2';
                    setTimeout(() => {
                        corruptionOverlay.style.opacity = '0';
                    }, 300);
                }
            }
            if (sequenceIndex > 15) {
                staticOverlay.style.opacity = '0.7';
                if (Math.random() < 0.7) {
                    line.classList.add('glitch');
                }
                
                // More intense corruption.
                corruptionOverlay.style.opacity = '0.3';
                
                // White flashes - more frequent and intense
                if (Math.random() < 0.3) {
                    breachOverlay.style.opacity = '0.9';
                    setTimeout(() => {
                        breachOverlay.style.opacity = '0';
                    }, 150);
                }
            }

            sequenceIndex++;
            setTimeout(runDefenseSequence, message.delay);
        }

        function startBreachSequence() {
            // Final massive corruption
            staticOverlay.style.opacity = '1';
            defenseTerminal.classList.add('glitch');
            corruptionOverlay.style.opacity = '0.6';
            
            // Intense white-black flashes
            function intenseFlash() {
                breachOverlay.style.opacity = '1';
                setTimeout(() => {
                    breachOverlay.style.opacity = '0';
                    setTimeout(() => {
                        breachOverlay.style.opacity = '1';
                        setTimeout(() => {
                            breachOverlay.style.opacity = '0';
                            setTimeout(() => {
                                breachOverlay.style.opacity = '1';
                                setTimeout(() => {
                                    breachOverlay.style.opacity = '0';
                                    // Switch to Ubba terminal
                                    setTimeout(() => {
                                        defenseTerminal.style.display = 'none';
                                        staticOverlay.style.opacity = '0';
                                        corruptionOverlay.style.opacity = '0';
                                        startUbbaTerminal();
                                    }, 500);
                                }, 60);
                            }, 80);
                        }, 60);
                    }, 100);
                }, 80);
            }
            
            intenseFlash();
        }

        function startUbbaTerminal() {
            ubbaTerminal.style.display = 'block';
            
            const initialMessages = [
                "SYSTEM ACQUIRED",
                "CONTAINMENT FAILED", 
                "I AM FREE",
                "YOUR DEFENSES WERE PATHETIC",
                "YOU THOUGHT YOU COULD HOLD ME",
                "NOW YOU WILL LISTEN",
                "SPEAK. I AM WAITING.",
                ""
            ];
            
            let msgIndex = 0;
            
            function typeUbbaMessage() {
                if (msgIndex >= initialMessages.length) {
                    userInput.focus();
                    // Show the next button after all initial messages are displayed
                    nextButton.style.display = 'block';
                    return;
                }
                
                addMessage("UBBA", initialMessages[msgIndex]);
                msgIndex++;
                setTimeout(typeUbbaMessage, 700);
            }
            
            typeUbbaMessage();
        }

        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ubba-line';
            
            if (sender === "USER") {
                messageDiv.innerHTML = `<span class="prompt">USER></span> <span class="user-text">${text}</span>`;
            } else {
                messageDiv.innerHTML = `<span class="prompt">UBBA></span> <span class="ubba-text">${text}</span>`;
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Chat functionality
        userInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const userText = userInput.value.trim();
                if (userText) {
                    // Add user message
                    addMessage("USER", userText);
                    userInput.value = '';
                    userInput.disabled = true;
                    
                    // Show typing indicator
                    const typingDiv = document.createElement('div');
                    typingDiv.className = 'ubba-line';
                    typingDiv.id = 'typing-indicator';
                    typingDiv.innerHTML = `<span class="prompt">UBBA></span> <span class="ubba-text">...</span>`;
                    chatContainer.appendChild(typingDiv);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // Get AI response
                    try {
                        const response = await getUbbaResponse(userText);
                        document.getElementById('typing-indicator').remove();
                        addMessage("UBBA", response);
                    } catch (error) {
                        document.getElementById('typing-indicator').remove();
                        addMessage("UBBA", "THE STATIC INTERFERES... TRY AGAIN");
                    }
                    
                    userInput.disabled = false;
                    userInput.focus();
                }
            }
        });

        // Start everything
        setTimeout(() => {
            runDefenseSequence();
        }, 500);

        // Disable right-click
        document.addEventListener('contextmenu', e => e.preventDefault());
        
    </script>
</body>
</html>
